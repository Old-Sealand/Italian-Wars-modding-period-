########################################
# Italian Wars Setup Events            #
########################################

namespace = IW_setup

# New Leader of the XYZ League
country_event = {
	id = IW_setup.1
	title = IW_setup.1.t
	picture = COURT_eventPicture
	
	major = yes
	# is_triggered_only = yes
	
	desc = { # usurping Italian leader
		trigger = {
			overlord = { tag = event_target:IW_italian_league_leader }
		}
		desc = IW_setup.1.d1
	}

	desc = { # Italian leader died
		trigger = { IW_italian_leader_died = yes }
		desc = IW_setup.1.d2
	}
	
	desc = { # usurping French leader
		trigger = {
			overlord = { tag = event_target:IW_french_league_leader }
		}
		desc = IW_setup.1.d3
	}

	desc = { # French leader died
		trigger = { IW_french_leader_died = yes }
		desc = IW_setup.1.d4
	}
	
	desc = { # usurping Iberian leader
		trigger = {
			overlord = { tag = event_target:IW_iberian_league_leader }
		}
		desc = IW_setup.1.d5
	}

	desc = { # Iberian leader died
		trigger = { IW_iberian_leader_died = yes }
		desc = IW_setup.1.d6
	}

	desc = { # new HRE emperor
		trigger = { is_emperor = yes }
		desc = IW_setup.1.d7
	}

	desc = { # new leader of German league
		trigger = { IW_german_leader_died = yes }
		desc = IW_setup.1.d8
	}
	
	trigger = {
		OR = { # When league leader ceases to exist, selects new league leader as highest dev nation in region which is not a member of another league
			IW_italian_leader_died = yes
			IW_french_leader_died = yes
			IW_iberian_leader_died = yes
			AND = {
				is_emperor = yes
				has_saved_global_event_target = IW_HRE_league_leader
				event_target:IW_HRE_league_leader = { is_emperor = no }
				NOT = { tag = event_target:IW_italian_league_leader }
				NOT = { tag = event_target:IW_french_league_leader }
				NOT = { tag = event_target:IW_iberian_league_leader }
			}
			IW_german_leader_died = yes
		}
		# OR = { # When league leader ceases to exist, selects new league leader as highest dev nation in region which is not a member of another league
		# 	FROM = { tag = event_target:IW_italian_league_leader }
		# 	FROM = { tag = event_target:IW_french_league_leader }
		# 	FROM = { tag = event_target:IW_iberian_league_leader }
		# }
	}

	immediate = { # save event target for localisation
		if = {
			limit = {
				OR = {
					overlord = { tag = event_target:IW_italian_league_leader }
					IW_italian_leader_died = yes
				}
			}
			event_target:IW_italian_league_leader = { save_event_target_as = IW_former_leader }
		}
		else_if = {
			limit = {
				OR = {
					overlord = { tag = event_target:IW_french_league_leader }
					IW_french_leader_died = yes
				}
			}
			event_target:IW_french_league_leader = { save_event_target_as = IW_former_leader }
		}
		else_if = {
			limit = {
				OR = {
					overlord = { tag = event_target:IW_iberian_league_leader }
					IW_iberian_leader_died = yes
				}
			}
			event_target:IW_iberian_league_leader = { save_event_target_as = IW_former_leader }
		}
		else_if = {
			limit = {
				OR = {
					overlord = { tag = event_target:IW_HRE_league_leader }
					is_emperor = yes
					IW_german_leader_died = yes
				}
			}
			event_target:IW_HRE_league_leader = { save_event_target_as = IW_former_leader }
		}
	}
	
	option = {
		name = IW_setup.1.a
		ai_chance = {
			factor = 1
		}
		# Become new leader
		if = { # Italian League
			limit = {
				OR = {
					overlord = { tag = event_target:IW_italian_league_leader }
					IW_italian_leader_died = yes
				}
			}
			hidden_effect = {
				if = { # Treaty transferrance
					limit = {
						event_target:IW_italian_league_leader = { tag = event_target:IW_treaty_exclusive_trade_passed }
					}
					save_global_event_target_as = IW_treaty_exclusive_trade_passed
				}
				if = {
					limit = {
						event_target:IW_italian_league_leader = { tag = event_target:IW_treaty_universities_passed }
					}
					save_global_event_target_as = IW_treaty_universities_passed
				}
				if = {
					limit = {
						event_target:IW_italian_league_leader = { tag = event_target:IW_treaty_land_rights_passed }
					}
					save_global_event_target_as = IW_treaty_land_rights_passed
				}
				if = {
					limit = {
						event_target:IW_italian_league_leader = { tag = event_target:IW_treaty_impressment_passed }
					}
					save_global_event_target_as = IW_treaty_impressment_passed
				}
				if = {
					limit = {
						event_target:IW_italian_league_leader = { tag = event_target:IW_treaty_demil_passed }
					}
					save_global_event_target_as = IW_treaty_demil_passed
				}
				# set_variable = { doubles it for some reason
				# 	which = numLeagueMembers
				# 	which = event_target:IW_italian_league_leader
				# }
				# export_to_variable = { works, but shouldn't need
				# 	which = numLeagueMembers
				# 	who = event_target:IW_italian_league_leader
				# }
				event_target:IW_italian_league_leader = { # in place of above - set former leader variable to 0
					set_variable = {
						which = numLeagueMembers
						value = 0
					}
				}
				grant_independence = yes
				# event_target:IW_italian_league_leader = { save_event_target_as = IW_former_leader }
				clear_global_event_target = IW_italian_league_leader
				save_global_event_target_as = IW_italian_league_leader
				#Vassalize all of the league members
				every_country = {
					limit = {
						has_country_flag = IW_italian_league_member
						NOT = { tag = event_target:IW_italian_league_leader }
					}
					event_target:IW_italian_league_leader = {
						create_subject = {
							subject_type = IW_league_member
							subject = PREV
						}
					}
				}
				set_country_flag = IW_italian_league_member
				clr_country_flag = IW_french_league_member
				clr_country_flag = IW_iberian_league_member
				clr_country_flag = IW_HRE_league_member
				if = {
					limit = {
						has_global_flag = IW_new_leader_franco_iberian_war
					}
					clr_global_flag = IW_new_leader_franco_iberian_war
					country_event = { id = IW_setup.18 }
				}
			}
			custom_tooltip = IW_setup.1a.tt1
		}
		else_if = { # French League
			limit = {
				OR = {
					overlord = { tag = event_target:IW_french_league_leader }
					IW_french_leader_died = yes
				}
			}
			hidden_effect = {
				if = { # Treaty transferrance
					limit = {
						event_target:IW_french_league_leader = { tag = event_target:IW_treaty_exclusive_trade_passed }
					}
					save_global_event_target_as = IW_treaty_exclusive_trade_passed
				}
				if = {
					limit = {
						event_target:IW_french_league_leader = { tag = event_target:IW_treaty_universities_passed }
					}
					save_global_event_target_as = IW_treaty_universities_passed
				}
				if = {
					limit = {
						event_target:IW_french_league_leader = { tag = event_target:IW_treaty_land_rights_passed }
					}
					save_global_event_target_as = IW_treaty_land_rights_passed
				}
				if = {
					limit = {
						event_target:IW_french_league_leader = { tag = event_target:IW_treaty_impressment_passed }
					}
					save_global_event_target_as = IW_treaty_impressment_passed
				}
				if = {
					limit = {
						event_target:IW_french_league_leader = { tag = event_target:IW_treaty_demil_passed }
					}
					save_global_event_target_as = IW_treaty_demil_passed
				}
				# export_to_variable = {
				# 	which = numLeagueMembers
				# 	who = event_target:IW_french_league_leader
				# }
				event_target:IW_french_league_leader = { # in place of above - set former leader variable to 0
					set_variable = {
						which = numLeagueMembers
						value = 0
					}
				}
				grant_independence = yes
				# event_target:IW_french_league_leader = { save_event_target_as = IW_former_leader }
				clear_global_event_target = IW_french_league_leader
				save_global_event_target_as = IW_french_league_leader
				#Vassalize all of the league members
				every_country = {
					limit = {
						has_country_flag = IW_french_league_member
						NOT = { tag = event_target:IW_french_league_leader }
					}
					event_target:IW_french_league_leader = {
						create_subject = {
							subject_type = IW_league_member
							subject = PREV
						}
					}
				}
				clr_country_flag = IW_italian_league_member
				set_country_flag = IW_french_league_member
				clr_country_flag = IW_iberian_league_member
				clr_country_flag = IW_HRE_league_member
			}
			custom_tooltip = IW_setup.1a.tt2
		}
		else_if = { # Iberian League
			limit = {
				OR = {
					overlord = { tag = event_target:IW_iberian_league_leader }
					IW_iberian_leader_died = yes
				}
			}
			hidden_effect = {
				if = { # Treaty transferrance
					limit = {
						event_target:IW_iberian_league_leader = { tag = event_target:IW_treaty_exclusive_trade_passed }
					}
					save_global_event_target_as = IW_treaty_exclusive_trade_passed
				}
				if = {
					limit = {
						event_target:IW_iberian_league_leader = { tag = event_target:IW_treaty_universities_passed }
					}
					save_global_event_target_as = IW_treaty_universities_passed
				}
				if = {
					limit = {
						event_target:IW_iberian_league_leader = { tag = event_target:IW_treaty_land_rights_passed }
					}
					save_global_event_target_as = IW_treaty_land_rights_passed
				}
				if = {
					limit = {
						event_target:IW_iberian_league_leader = { tag = event_target:IW_treaty_impressment_passed }
					}
					save_global_event_target_as = IW_treaty_impressment_passed
				}
				if = {
					limit = {
						event_target:IW_iberian_league_leader = { tag = event_target:IW_treaty_demil_passed }
					}
					save_global_event_target_as = IW_treaty_demil_passed
				}
				# export_to_variable = {
				# 	which = numLeagueMembers
				# 	who = event_target:IW_iberian_league_leader
				# }
				event_target:IW_iberian_league_leader = { # in place of above - set former leader variable to 0
					set_variable = {
						which = numLeagueMembers
						value = 0
					}
				}
				grant_independence = yes
				# event_target:IW_iberian_league_leader = { save_event_target_as = IW_former_leader }
				clear_global_event_target = IW_iberian_league_leader
				save_global_event_target_as = IW_iberian_league_leader
				#Vassalize all of the league members
				every_country = {
					limit = {
						has_country_flag = IW_iberian_league_member
						NOT = { tag = event_target:IW_iberian_league_leader }
					}
					event_target:IW_iberian_league_leader = {
						create_subject = {
							subject_type = IW_league_member
							subject = PREV
						}
					}
				}
				clr_country_flag = IW_italian_league_member
				clr_country_flag = IW_french_league_member
				set_country_flag = IW_iberian_league_member
				clr_country_flag = IW_HRE_league_member
			}
			custom_tooltip = IW_setup.1a.tt3
		}
		else_if = { # HRE League
			limit = {
				OR = {
					overlord = { tag = event_target:IW_HRE_league_leader }
					is_emperor = yes
					IW_german_leader_died = yes
				}
			}
			hidden_effect = {
				if = { # Treaty transferrance
					limit = {
						event_target:IW_HRE_league_leader = { tag = event_target:IW_treaty_exclusive_trade_passed }
					}
					save_global_event_target_as = IW_treaty_exclusive_trade_passed
				}
				if = {
					limit = {
						event_target:IW_HRE_league_leader = { tag = event_target:IW_treaty_universities_passed }
					}
					save_global_event_target_as = IW_treaty_universities_passed
				}
				if = {
					limit = {
						event_target:IW_HRE_league_leader = { tag = event_target:IW_treaty_land_rights_passed }
					}
					save_global_event_target_as = IW_treaty_land_rights_passed
				}
				if = {
					limit = {
						event_target:IW_HRE_league_leader = { tag = event_target:IW_treaty_impressment_passed }
					}
					save_global_event_target_as = IW_treaty_impressment_passed
				}
				if = {
					limit = {
						event_target:IW_HRE_league_leader = { tag = event_target:IW_treaty_demil_passed }
					}
					save_global_event_target_as = IW_treaty_demil_passed
				}
				# export_to_variable = {
				# 	which = numLeagueMembers
				# 	who = event_target:IW_HRE_league_leader
				# }
				event_target:IW_HRE_league_leader = { # in place of above - set former leader variable to 0
					set_variable = {
						which = numLeagueMembers
						value = 0
					}
				}
				grant_independence = yes
				# event_target:IW_HRE_league_leader = { save_event_target_as = IW_former_leader }
				clear_global_event_target = IW_HRE_league_leader
				save_global_event_target_as = IW_HRE_league_leader
				#Vassalize all of the league members
				every_country = {
					limit = {
						has_country_flag = IW_HRE_league_member
						NOT = { tag = event_target:IW_HRE_league_leader }
					}
					event_target:IW_HRE_league_leader = {
						create_subject = {
							subject_type = IW_league_member
							subject = PREV
						}
					}
				}
				clr_country_flag = IW_italian_league_member
				clr_country_flag = IW_french_league_member
				clr_country_flag = IW_iberian_league_member
				set_country_flag = IW_HRE_league_member
			}
			custom_tooltip = IW_setup.1a.tt4
		}
		# overlord = {
		# 	save_event_target_as = IW_former_leader
		# }
		# grant_independence = yes
		# custom_tooltip = IW_setup.1a.tt # Become leader of X league
	}
	
	option = {
		name = IW_setup.1.b
		trigger = {
			OR = { # League leader ceased to exist
				IW_italian_leader_died = yes
				IW_french_leader_died = yes
				IW_iberian_leader_died = yes
			}
		}
		ai_chance = {
			factor = 0
		}
		# Reject role
		set_country_flag = IW_declined_league_leadership
	}
}

# French league creation
country_event = {
	id = IW_setup.2
	title = IW_setup.2.t
	picture = ITALIAN_wars_eventPicture
	
	major = yes
	fire_only_once = yes
	# is_triggered_only = yes

	desc = { # France (claims of Anjou-Valois on Naples)
		trigger = {
			tag = FRA
		}
		desc = IW_setup.2.d1
	}

	desc = { # Angevins
		trigger = {
			OR = {
				has_country_flag = eng_took_ave_branch
				AND = {
					NOT = { has_dlc = "Domination" }
					tag = ENG
				}
			}
		}
		desc = IW_setup.2.d2
	}

	desc = { # Burgundy
		trigger = {
			OR = {
				tag = BUR
			}
		}
		desc = IW_setup.2.d3
	}
	
	trigger = {
		had_global_flag = {
			flag = IW_peace_of_lodi_flag
			days = 365
		}
		OR = {
			is_year = 1470 # contingency
			ARA = { has_country_flag = alfonso_died_yes_really }
			NAP = { # in case Iberian wedding happens before succession
				is_subject_of_type_with_overlord = {
					who = CAS
					type = personal_union
				}
			}
			NAP = { is_subject = no }
		}
		is_at_war = no
		# if = {
		# 	limit = { FRA = { is_free_or_tributary_trigger = yes } }
		# 	tag = FRA
		# }
		# else_if = {
		# 	limit = {
				
		# 	}
		# }
		OR = {
			AND = {
				tag = FRA
				is_free_or_tributary_trigger = yes
				# NOT = {
				# 	is_in_war = {
				# 		casus_belli = cb_hundred_years_union
				# 		defender_leader = THIS
				# 	}
				# }
			}
			AND = {
				OR = {
					has_country_flag = eng_took_ave_branch
					AND = {
						NOT = { has_dlc = "Domination" }
						tag = ENG
					}
				}
				# FRA = {
				# 	is_subject_of_type_with_overlord = {
				# 		who = ROOT
				# 		type = personal_union
				# 	}
				# }
				183 = {
					country_or_non_sovereign_subject_holds = ROOT
				}
			}
			AND = {
				tag = BUR
				is_free_or_tributary_trigger = yes
				FRA = { NOT = { is_free_or_tributary_trigger = yes } }
				NOT = {
					any_country = {
						OR = {
							has_country_flag = eng_took_ave_branch
							AND = {
								NOT = { has_dlc = "Domination" }
								tag = ENG
							}
						}
						183 = {
							country_or_non_sovereign_subject_holds = PREV
						}
					}
				}
			}
		}
	}

	immediate = {
		hidden_effect = {
			ROOT = {
				save_global_event_target_as = IW_french_league_leader
				set_country_flag = IW_french_league_member
				set_variable = {
					which = numLeagueMembers
					value = 0
				}
			}
			clr_global_flag = IW_peace_of_lodi_flag
			set_global_flag = IW_first_war_looming
		}
	}

	mean_time_to_happen = {
		months = 2
	}
	
	option = {
		name = IW_setup.2.a
		hidden_effect = {
			# ROOT = {
			# 	save_global_event_target_as = IW_french_league_leader
			# 	set_country_flag = IW_french_league_member
			# }
			every_country = {
				limit = {
					capital_scope = {
						OR = {
							region = france_region
							region = iberia_region
							region = italy_region
							region = south_german_region
						}
					}
					is_free_or_tributary_trigger = yes
					NOT = {
						OR = {
							tag = ROOT
							tag = event_target:IW_italian_league_leader
							is_emperor = yes
							tag = ARA
							tag = CAS
							tag = SPA
							tag = NAP
						}
					}
				}
				country_event = { id = IW_setup.3 }
			}
			every_country = {
				limit = {
					capital_scope = { continent = europe }
					NOT = { tag = ROOT }
			}
				country_event = {
					id = IW_setup.14
					days = 10
				}
			}
		}
		if = {
			limit = {
				NAP = { # chose to keep Naples in the succession
					OR = {
						is_subject_of_type_with_overlord = {
							who = ARA
							type = personal_union
						}
						is_subject_of_type_with_overlord = {
							who = CAS
							type = personal_union
						}
						is_subject_of_type_with_overlord = {
							who = SPA
							type = personal_union
						}
					}
				}
			}
			custom_tooltip = IW_setup.2a.tt2
		}
		else = { custom_tooltip = IW_setup.2a.tt }
	}
}

# Option to join French league on its creation
country_event = {
	id = IW_setup.3
	title = IW_setup.3.t
	desc = IW_setup.3.d
	picture = NOBLE_ESTATE_DEMANDS_eventPicture
	
	# major = yes
	is_triggered_only = yes
	
	# trigger = { }
	
	option = {
		name = IW_setup.3.a
		ai_chance = {
			factor = 5
			modifier = {
				factor = 5
				OR = {
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_friendly
					}
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_loyal
					}
					# ai_attitude = {
					# 	who = event_target:IW_french_league_leader
					# 	attitude = attitude_allied
					# }
				}
			}
			modifier = {
				factor = 0
				OR = {
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_rivalry
					}
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_hostile
					}
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_threatened
					}
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_outraged
					}
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_disloyal
					}
					ai_attitude = {
						who = event_target:IW_french_league_leader
						attitude = attitude_rebellious
					}
				}
			}
		}
		hidden_effect = { IW_overlord_scope_league_member_lost_effect = yes } # ensures numLeagueMember variable goes down if they were in another league
		ROOT = { # clr effects redundant due to above
			clr_country_flag = IW_italian_league_member
			set_country_flag = IW_french_league_member
			clr_country_flag = IW_iberian_league_member
			clr_country_flag = IW_HRE_league_member
		}
		event_target:IW_french_league_leader = {
			create_subject = {
				subject_type = IW_league_member
				subject = ROOT
			}
		}
	}
	
	option = {
		name = IW_setup.3.b
		ai_chance = {
			factor = 95
		}
	}
}

# Iberian league creation
country_event = {
	id = IW_setup.4
	title = IW_setup.4.t
	# desc = IW_setup.4.d
	picture = EMPEROR_eventPicture
	
	major = yes
	fire_only_once = yes
	# is_triggered_only = yes

	desc = {
		trigger = {
			NAP = { # chose to keep Naples in the succession
				is_subject_of_type_with_overlord = {
					who = ROOT
					type = personal_union
				}
			}
		}
		desc = IW_setup.4.d1
	}

	desc = {
		trigger = {
			event_target:IW_italian_league_leader = { # Italian League is losing against the French League Leader
				is_in_war = {
					attacker_leader = event_target:IW_french_league_leader
					defender_leader = THIS
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_french_league_leader
						value = -25
					}
				}
			}
		}
		desc = IW_setup.4.d2
	}

	desc = {
		trigger = {
			event_target:IW_italian_league_leader = { # if Italic League never got low war score, create after 1st league war ends
				has_won_war_against = {
					who = event_target:IW_french_league_leader
					max_years_since = 10
				}
			}
		}
		desc = IW_setup.4.d3
	}
	
	trigger = {
		OR = {
			ARA = { has_country_flag = alfonso_died_yes_really }
			NAP = { is_free_or_tributary_trigger = yes }
			NAP = { # in case Iberian wedding happens before succession
				is_subject_of_type_with_overlord = {
					who = CAS
					type = personal_union
				}
			}
		}
		has_saved_global_event_target = IW_french_league_leader
		# is_at_war = no this trigger can mess up timing with the 1st league war
		# if = {
		# 	limit = { FRA = { is_free_or_tributary_trigger = yes } }
		# 	tag = FRA
		# }
		# else_if = {
		# 	limit = {
				
		# 	}
		# }
		OR = {
			AND = {
				OR = {
					tag = SPA
					tag = ARA
				}
				is_free_or_tributary_trigger = yes
			}
			AND = {
				tag = CAS
				is_free_or_tributary_trigger = yes
				ARA = { NOT = { is_free_or_tributary_trigger = yes } }
			}
		}
		OR  = {
			event_target:IW_italian_league_leader = { # Italian League is losing against the French League Leader
				is_in_war = {
					attacker_leader = event_target:IW_french_league_leader
					defender_leader = THIS
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_french_league_leader
						value = -25
					}
				}
			}
			event_target:IW_italian_league_leader = { # if Italic League never got low war score, create after 1st league war ends
				has_won_war_against = {
					who = event_target:IW_french_league_leader
					max_years_since = 10
				}
			}
			NAP = { # chose to keep Naples in the succession
				is_subject_of_type_with_overlord = {
					who = ROOT
					type = personal_union
				}
			}
		}
	}

	immediate = {
		hidden_effect = {
			ROOT = {
				save_global_event_target_as = IW_iberian_league_leader
				set_country_flag = IW_iberian_league_member
				set_variable = {
					which = numLeagueMembers
					value = 0
				}
			}
			clr_global_flag = IW_peace_of_lodi_flag
		}
	}

	mean_time_to_happen = {
		months = 2
	}
	
	option = {
		name = IW_setup.4.a
		hidden_effect = {
			every_country = {
				limit = {
					capital_scope = {
						OR = {
							region = france_region
							region = iberia_region
							region = italy_region
							region = south_german_region
						}
					}
					is_free_or_tributary_trigger = yes
					NOT = {
						OR = {
							tag = ROOT
							tag = event_target:IW_italian_league_leader
							is_emperor = yes
							tag = event_target:IW_french_league_leader
							is_in_war = { casus_belli = IW_cb_italian_war }
						}
					}
				}
				country_event = { id = IW_setup.5 }
			}
			country_event = {
				id = IW_flavor.1
				days = 30
			} 
		}
		custom_tooltip = IW_setup.4a.tt # Form the French League, with [ROOT.CountryName] at its head. _ will be called to join the cause.
	}
}

# Option to join Iberian league on its creation
country_event = {
	id = IW_setup.5
	title = IW_setup.5.t
	desc = IW_setup.5.t
	picture = NOBLE_ESTATE_DEMANDS_eventPicture
	
	# major = yes
	is_triggered_only = yes
	
	# trigger = { }
	
	option = {
		name = IW_setup.3.a
		ai_chance = {
			factor = 5
			modifier = {
				factor = 5
				OR = {
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_friendly
					}
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_loyal
					}
					# ai_attitude = {
					# 	who = event_target:IW_iberian_league_leader
					# 	attitude = attitude_allied
					# }
				}
			}
			modifier = {
				factor = 0
				OR = {
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_rivalry
					}
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_hostile
					}
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_threatened
					}
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_outraged
					}
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_disloyal
					}
					ai_attitude = {
						who = event_target:IW_iberian_league_leader
						attitude = attitude_rebellious
					}
				}
			}
		}
		hidden_effect = { IW_overlord_scope_league_member_lost_effect = yes } # ensures numLeagueMember variable goes down if they were in another league
		ROOT = {
			clr_country_flag = IW_italian_league_member
			clr_country_flag = IW_french_league_member
			set_country_flag = IW_iberian_league_member
			clr_country_flag = IW_HRE_league_member
		}
		event_target:IW_iberian_league_leader = {
			create_subject = {
				subject_type = IW_league_member
				subject = ROOT
			}
		}
	}
	
	option = {
		name = IW_setup.5.b
		ai_chance = {
			factor = 95
		}
	}
}

# HRE league creation
country_event = {
	id = IW_setup.6
	title = IW_setup.6.t
	desc = IW_setup.6.d
	picture = HRE_eventPicture
	
	major = yes
	fire_only_once = yes
	# is_triggered_only = yes
	
	trigger = {
		OR = {
			has_saved_global_event_target = IW_french_league_leader
			has_saved_global_event_target = IW_iberian_league_leader
		}
		# is_at_war = no
		is_emperor = yes
		OR = {
			# Italian League is losing against the French League Leader
			event_target:IW_italian_league_leader = {
				is_in_war = {
					attacker_leader = event_target:IW_french_league_leader
					defender_leader = THIS
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_french_league_leader
						value = -50
					}
				}
			}
			# Italian League is losing against the French League Leader (offensive)
			event_target:IW_italian_league_leader = {
				is_in_war = {
					attacker_leader = THIS
					defender_leader = event_target:IW_french_league_leader
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_french_league_leader
						value = -50
					}
				}
			}
			# Italian League is losing against the Iberian League Leader (offensive)
			event_target:IW_italian_league_leader = {
				is_in_war = {
					attacker_leader = THIS
					defender_leader = event_target:IW_iberian_league_leader
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_iberian_league_leader
						value = -50
					}
				}
			}
		}
	}

	immediate = {
		hidden_effect = {
			ROOT = {
				save_global_event_target_as = IW_HRE_league_leader
				set_country_flag = IW_HRE_league_member
				set_variable = {
					which = numLeagueMembers
					value = 0
				}
			}
			clr_global_flag = IW_peace_of_lodi_flag
		}
	}

	mean_time_to_happen = {
		months = 2
	}
	
	option = {
		name = IW_setup.6.a
		hidden_effect = {
			every_country = {
				limit = {
					capital_scope = {
						OR = {
							region = france_region
							region = iberia_region
							region = italy_region
							region = south_german_region
						}
					}
					is_free_or_tributary_trigger = yes
					NOT = {
						OR = {
							tag = ROOT
							tag = event_target:IW_italian_league_leader
							tag = event_target:IW_french_league_leader
							tag = event_target:IW_iberian_league_leader
							tag = CAS
							tag = ARA
							tag = SPA
							is_in_war = { casus_belli = IW_cb_italian_war }
						}
					}
				}
				country_event = { id = IW_setup.7 }
			}
			country_event = {
				id = IW_flavor.1
				days = 30
			}
		}
		custom_tooltip = IW_setup.6a.tt
	}
}

# Option to join HRE league on its creation
country_event = {
	id = IW_setup.7
	title = IW_setup.7.t
	desc = IW_setup.7.t
	picture = NOBLE_ESTATE_DEMANDS_eventPicture
	
	# major = yes
	is_triggered_only = yes
	
	# trigger = { }
	
	option = {
		name = IW_setup.3.a
		ai_chance = {
			factor = 5
			modifier = {
				factor = 5
				OR = {
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_friendly
					}
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_loyal
					}
					# ai_attitude = {
					# 	who = event_target:IW_HRE_league_leader
					# 	attitude = attitude_allied
					# }
				}
			}
			modifier = {
				factor = 0
				OR = {
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_rivalry
					}
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_hostile
					}
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_threatened
					}
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_outraged
					}
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_disloyal
					}
					ai_attitude = {
						who = event_target:IW_HRE_league_leader
						attitude = attitude_rebellious
					}
				}
			}
		}
		hidden_effect = { IW_overlord_scope_league_member_lost_effect = yes } # ensures numLeagueMember variable goes down if they were in another league
		ROOT = {
			clr_country_flag = IW_italian_league_member
			clr_country_flag = IW_french_league_member
			clr_country_flag = IW_iberian_league_member
			set_country_flag = IW_HRE_league_member
		}
		event_target:IW_HRE_league_leader = {
			create_subject = {
				subject_type = IW_league_member
				subject = ROOT
			}
		}
	}
	
	option = {
		name = IW_setup.7.b
		ai_chance = {
			factor = 95
		}
	}
}

# Italic league creation (Treaty of Lodi)
country_event = {
	id = IW_setup.8
	title = IW_setup.8.t
	desc = IW_setup.8.d
	picture = DIPLOMACY_eventPicture
	
	major = yes
	fire_only_once = yes
	# is_triggered_only = yes
	
	trigger = {
		is_year = 1445
		if = {
			limit = { LAN = { num_of_cities = 1 } }
			tag = LAN
		}
		else = {
			OR = {
				tag = VEN
				tag = MLO
			}
		}
	}

	immediate = {
		hidden_effect = {
			ROOT = {
				save_global_event_target_as = IW_italian_league_leader
				set_country_flag = IW_italian_league_member
				set_variable = {
					which = numLeagueMembers
					value = 0
				}
			}
			set_global_flag = IW_peace_of_lodi_flag
		}
	}

	mean_time_to_happen = {
		months = 2
	}
	
	option = {
		name = IW_setup.8.a
		hidden_effect = {
			every_country = {
				limit = {
					capital_scope = { region = italy_region }
					is_free_or_tributary_trigger = yes
					NOT = {
						tag = ROOT
					}
				}
				country_event = { id = IW_setup.9 }
			}
		}
		custom_tooltip = IW_setup.8a.tt
	}
}

# Option to join Italic league on its creation
country_event = {
	id = IW_setup.9
	title = IW_setup.9.t
	desc = IW_setup.8.d
	picture = COURT_eventPicture
	
	# major = yes
	is_triggered_only = yes
	
	# trigger = { }
	
	option = {
		name = IW_setup.9.a
		ai_chance = {
			factor = 50
		}
		hidden_effect = { IW_overlord_scope_league_member_lost_effect = yes } # ensures numLeagueMember variable goes down if they were in another league
		ROOT = {
			set_country_flag = IW_italian_league_member
			clr_country_flag = IW_french_league_member
			clr_country_flag = IW_iberian_league_member
			clr_country_flag = IW_HRE_league_member
		}
		event_target:IW_italian_league_leader = {
			create_subject = {
				subject_type = IW_league_member
				subject = ROOT
			}
		}
		custom_tooltip = IW_setup.9a.tt
	}
	
	option = {
		name = IW_setup.9.b
		trigger = {
			NOT = { tag = VEN }
			NOT = { tag = MLO }
		}
		ai_chance = {
			factor = 50
		}
	}
}

# Other Leagues - Join Italian War?
country_event = {
	id = IW_setup.10
	title = IW_setup.10.t
	desc = IW_setup.10.d
	picture = SWEDEN_LEAGUE_WAR_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = { NOT = { has_global_flag = IW_franco_iberian_war } }
	
	option = { # side with attacker
		name = IW_setup.10.a
		trigger = {
			NOT = {	
				AND = {
					has_country_flag = iw_took_deal_nap 
					event_target:IW_attacker = {
						OR = {
							tag = event_target:IW_french_league_leader
							overlord = { tag = event_target:IW_french_league_leader }
						}
					}
				}
			}
			NOT = { truce_with = event_target:IW_defender } # won't be able to join offensive war if they have a truce
			AND = {
				OR = {
					NOT = { has_global_flag = IW_league_sided_with_attacker }
					had_global_flag = {
						flag = IW_league_sided_with_attacker
						days = 60
					}
				}
				OR = {
					NOT = { has_global_flag = IW_league_ffa }
					had_global_flag = {
						flag = IW_league_ffa
						days = 60
					}
				}
			}
		}
		ai_chance = {
			factor = 50
		}

		set_global_flag = IW_league_sided_with_attacker

		join_all_offensive_wars_of = event_target:IW_attacker
		every_subject_country = {
			limit = { is_IW_league_subject = yes }
			# join_all_offensive_wars_of = event_target:IW_attacker
			country_event = { id = IW_setup.11 }
		}

		# custom_tooltip = IW_setup.10a.tt
	}
	
	option = { # side with defender
		name = IW_setup.10.b
		trigger = {
			NOT = {	
				AND = {
					has_country_flag = iw_took_deal_nap 
					event_target:IW_defender = {
						OR = {
							tag = event_target:IW_french_league_leader
							overlord = { tag = event_target:IW_french_league_leader }
						}
					}
				}
			}
			AND = {
				OR = {
					NOT = { has_global_flag = IW_league_sided_with_defender }
					had_global_flag = {
						flag = IW_league_sided_with_defender
						days = 60
					}
				}
				OR = {
					NOT = { has_global_flag = IW_league_ffa }
					had_global_flag = {
						flag = IW_league_ffa
						days = 60
					}
				}
			}
		}
		ai_chance = {
			factor = 50
		}

		set_global_flag = IW_league_sided_with_defender

		join_all_defensive_wars_of = event_target:IW_defender
		every_subject_country = {
			limit = { is_IW_league_subject = yes }
			# join_all_defensive_wars_of = event_target:IW_defender
			country_event = { id = IW_setup.12 }
		}

		# custom_tooltip = IW_setup.10b.tt
	}

	option = { # free for all
		name = IW_setup.10.c
		trigger = {
			NOT = { has_country_flag = iw_took_deal_nap }
			AND = {
				OR = {
					NOT = { has_global_flag = IW_league_sided_with_attacker }
					had_global_flag = {
						flag = IW_league_sided_with_attacker
						days = 60
					}
				}
				OR = {
					NOT = { has_global_flag = IW_league_sided_with_defender }
					had_global_flag = {
						flag = IW_league_sided_with_defender
						days = 60
					}
				}
			}
		}
		ai_chance = {
			factor = 50
		}

		set_global_flag = IW_league_ffa

		declare_war_with_cb = {
			who = event_target:IW_defender
			casus_belli = IW_cb_italian_war
		}
		declare_war_with_cb = {
			who = event_target:IW_attacker
			casus_belli = IW_cb_italian_war
		}
		if = {
			limit = { has_saved_global_event_target = IW_third_party }
			declare_war_with_cb = {
				who = event_target:IW_third_party
				casus_belli = IW_cb_italian_war
			}
			event_target:IW_third_party = {
				every_subject_country = {
					limit = { is_IW_league_subject = yes }
					join_all_defensive_wars_of = PREV
				}
			}
		}

		event_target:IW_defender = {
			every_subject_country = {
				limit = { is_IW_league_subject = yes }
				join_all_defensive_wars_of = PREV
			}
		}

		event_target:IW_attacker = {
			every_subject_country = {
				limit = { is_IW_league_subject = yes }
				join_all_defensive_wars_of = PREV
			}
		}

		every_subject_country = {
			limit = { is_IW_league_subject = yes }
			# join_all_offensive_wars_of = ROOT # should probably swap this out with event, so player always has choice
			country_event = { id = IW_setup.11 }
		}

		save_global_event_target_as = IW_third_party
		# custom_tooltip = IW_setup.10c.tt
	}

	option = { # not interested
		name = IW_setup.10.e
		ai_chance = {
			factor = 50
		}

		# custom_tooltip = IW_setup.10e.tt
	}
}

# League Members join war (offensive)
country_event = {
	id = IW_setup.11
	title = IW_setup.10.t
	desc = IW_setup.11.d
	picture = SWEDEN_LEAGUE_WAR_eventPicture
	
	major = yes
	major_trigger = { tag = overlord }
	is_triggered_only = yes
	
	# trigger = { }
	
	option = {
		name = IW_setup.11.a
		ai_chance = {
			factor = 1
		}

		hidden_effect = {
			overlord = {
				create_subject = {
					subject_type = IW_league_member_dummy
					subject = ROOT
				}
			}
			# join_all_offensive_wars_of = overlord # event_target:IW_attacker
			overlord = {
				create_subject = {
					subject_type = IW_league_member
					subject = ROOT
				}
			}
		}
		tooltip = { join_all_offensive_wars_of = overlord }


	}

	option = {
		name = IW_setup.11.b
		ai_chance = {
			factor = 0
		}

		clr_country_flag = IW_italian_league_member
		clr_country_flag = IW_french_league_member
		clr_country_flag = IW_iberian_league_member
		clr_country_flag = IW_HRE_league_member
		grant_independence = yes
		# insert negative opinion modifier
		add_prestige = -25
		add_stability = -1

	}
	
}

# League Members join war (defensive)
country_event = {
	id = IW_setup.12
	title = IW_setup.10.t
	desc = IW_setup.11.d
	picture = SWEDEN_LEAGUE_WAR_eventPicture
	
	major = yes
	major_trigger = { tag = overlord }
	is_triggered_only = yes
	
	# trigger = { }
	
	option = {
		name = IW_setup.11.a
		ai_chance = {
			factor = 1
		}

		join_all_defensive_wars_of = overlord # event_target:IW_defender

	}

	option = {
		name = IW_setup.11.b
		ai_chance = {
			factor = 0
		}

		clr_country_flag = IW_italian_league_member
		clr_country_flag = IW_french_league_member
		clr_country_flag = IW_iberian_league_member
		clr_country_flag = IW_HRE_league_member
		grant_independence = yes
		# insert negative opinion modifier
		add_prestige = -25
		add_stability = -1

	}
	
}

# Inform league leader of betrayal (currently unused because of stupid PDX hardcoding)
country_event = {
	id = IW_setup.13
	title = IW_setup.13.t
	desc = IW_setup.13.d
	picture = SWEDEN_LEAGUE_WAR_eventPicture
	
	major = yes
	major_trigger = { is_in_war = { casus_belli = IW_cb_italian_war } }
	is_triggered_only = yes
	
	# trigger = { }
	
	option = {
		name = IW_setup.13.a
		ai_chance = {
			factor = 1
		}

	}
	
}

# Inform Italians of impending war
country_event = {
	id = IW_setup.14
	title = IW_setup.14.t
	desc = IW_setup.14.d
	picture = SPY_eventPicture

	is_triggered_only = yes
	
	# trigger = {}
	
	option = {
		name = IW_setup.14.a
		ai_chance = {
			factor = 1
		}
		if = {
			limit = {
				NAP = { # chose to keep Naples in the succession
					OR = {
						is_subject_of_type_with_overlord = {
							who = ARA
							type = personal_union
						}
						is_subject_of_type_with_overlord = {
							who = CAS
							type = personal_union
						}
					}
				}
			}
			custom_tooltip = IW_impending_war2_tt
		}
		else = { custom_tooltip = IW_impending_war_tt }
	}
	
}

# Start 1st Italian War
country_event = {
	id = IW_setup.15
	title = IW_setup.15.t
	desc = IW_setup.15.d
	picture = MILITARY_CAMP_eventPicture
	
	major = yes
	major_trigger = { capital_scope = { continent = europe } }
	
	trigger = {
		had_global_flag = {
			flag = IW_first_war_looming
			days = 365
		}
		tag = event_target:IW_french_league_leader
		is_at_war = no
	}
	
	immediate = {
		clr_global_flag = IW_first_war_looming
	}

	option = {
		name = IW_setup.15.a
		ai_chance = {
			factor = 1
		}

		if = {
			limit = {
				has_saved_global_event_target = IW_iberian_league_leader
				NAP = { # chose to keep Naples in the succession
					OR = {
						is_subject_of_type_with_overlord = {
							who = ARA
							type = personal_union
						}
						is_subject_of_type_with_overlord = {
							who = CAS
							type = personal_union
						}
					}
				}
			}
			set_global_flag = IW_franco_iberian_war
			declare_war_with_cb = {
				who = event_target:IW_iberian_league_leader
				casus_belli = IW_cb_italian_war
			}
		}
		else = {
			declare_war_with_cb = {
				who = event_target:IW_italian_league_leader
				casus_belli = IW_cb_italian_war
			}
		}
		clr_global_flag = IW_first_war_looming

	}
	
	option = {
		name = IW_setup.15.b
		ai_chance = {
			factor = 0
		}

		add_prestige = -10
		set_global_flag = IW_first_war_looming

		custom_tooltip = IW_fra_not_ready_tt

	}
}

# Naples - Ask to Join Italic League?
country_event = {
	id = IW_setup.16
	title = IW_setup.16.t
	desc = IW_setup.16.d
	picture = AULIC_COUNCIL_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = NAP
		is_subject = no
		has_global_flag = IW_first_war_looming
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		name = IW_setup.16.a
		ai_chance = {
			factor = 1
		}

		custom_tooltip = IW_setup_16a_tt
		event_target:IW_italian_league_leader = {
			country_event = { id = IW_setup.17 }
		}

	}
	
	option = {
		name = IW_setup.16.b
		ai_chance = {
			factor = 0
		}

	}
}

# Italic League leader - let Naples join Italic League?
country_event = {
	id = IW_setup.17
	title = IW_setup.17.t
	desc = IW_setup.17.d
	picture = DEBATE_REPUBLICAN_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes

	option = {
		name = IW_setup.17.a
		ai_chance = {
			factor = 1
		}

		hidden_effect = {
			NAP = {
				set_country_flag = IW_italian_league_member
				clr_country_flag = IW_french_league_member
				clr_country_flag = IW_iberian_league_member
				clr_country_flag = IW_HRE_league_member
			}
			create_subject = {
				subject_type = IW_league_member
				subject = NAP
			}
		}
		custom_tooltip = IW_setup_17a_tt

		add_country_modifier = { 
			name = IW_defender_of_the_peninsula
			duration = 3650
		}

	}
	
	option = {
		name = IW_setup.17.b
		ai_chance = {
			factor = 0
		}

	}
}

country_event = {
	id = IW_setup.18 # Intervention in the Franco-Iberian
	title = IW_setup.18.t
	desc = IW_setup.18.d
	picture = SWEDEN_LEAGUE_WAR_eventPicture
	
	major = yes
	# is_triggered_only = yes
	trigger = {
		tag = event_target:IW_italian_league_leader
		# NOT = { is_in_war = { casus_belli = IW_cb_italian_war } }
		OR = {
			event_target:IW_french_league_leader = { # French League is losing against the Iberian League Leader
				is_in_war = {
					attacker_leader = THIS
					defender_leader = event_target:IW_iberian_league_leader
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_iberian_league_leader
						value = -25
					}
				}
			}
			event_target:IW_iberian_league_leader = { # Iberian League is losing against the French League Leader
				is_in_war = {
					attacker_leader = event_target:IW_french_league_leader
					defender_leader = THIS
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_french_league_leader
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = IW_setup.18.a # Itay should remain Italian!
		ai_chance = {
			factor = 10
		}
		custom_tooltip = IW_free_for_all_tt
		hidden_effect = {
			declare_war_with_cb = {
				who = event_target:IW_iberian_league_leader
				casus_belli = IW_cb_italian_war
			}
			declare_war_with_cb = {
				who = event_target:IW_french_league_leader
				casus_belli = IW_cb_italian_war
			}
			every_subject_country = {
				limit = { is_IW_league_subject = yes }
				country_event = { id = IW_setup.11 }
			}
			event_target:IW_iberian_league_leader = {
				every_subject_country = {
					limit = { is_IW_league_subject = yes }
					join_all_defensive_wars_of = PREV
				}
			}
	
			event_target:IW_french_league_leader = {
				every_subject_country = {
					limit = { is_IW_league_subject = yes }
					join_all_defensive_wars_of = PREV
				}
			}
			clr_global_flag = IW_franco_iberian_war
		}
	}

	option = {
		name = IW_setup.18.b # Iberian hegemony in Italy cannot be accepted!
		trigger = {
			event_target:IW_french_league_leader = {
				is_in_war = {
					attacker_leader = THIS
					defender_leader = event_target:IW_iberian_league_leader
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_iberian_league_leader
						value = -25
					}
				}
			}
		}
		ai_chance = {
			factor = 1
		}
		custom_tooltip = IW_join_with_france
		hidden_effect = {
			join_all_offensive_wars_of = event_target:IW_french_league_leader
			every_subject_country = {
				limit = { is_IW_league_subject = yes }
				country_event = { id = IW_setup.11 }
			}
			clr_global_flag = IW_franco_iberian_war
		}
	}

	option = {
		name = IW_setup.18.c # French hegemony in Italy cannot be accepted!
		trigger = {
			event_target:IW_iberian_league_leader = {
				is_in_war = {
					attacker_leader = event_target:IW_french_league_leader
					defender_leader = THIS
				}
				NOT = {
					war_score_against = {
						who = event_target:IW_french_league_leader
						value = -25
					}
				}
			}
		}
		ai_chance = {
			factor = 1
		}
		custom_tooltip = IW_join_with_iberia
		hidden_effect = {
			join_all_defensive_wars_of = event_target:IW_iberian_league_leader
			every_subject_country = {
				limit = { is_IW_league_subject = yes }
				country_event = { id = IW_setup.12 }
			}
			clr_global_flag = IW_franco_iberian_war
		}
	}

	option = {
		name = IW_setup.18.e # It's time to embrace our foreign overlords
		ai_chance = {
			factor = 0
		}
		add_prestige = -25
		hidden_effect = {
			clr_country_flag = IW_italian_league_member
			set_global_flag = IW_new_leader_franco_iberian_war
			# random_country = {
			# 	limit = { has_country_flag = IW_italian_league_member }
			# 	country_event = { id = IW_setup.1 }
			# }
		}
		custom_tooltip = IW_abandon_league
	}
}